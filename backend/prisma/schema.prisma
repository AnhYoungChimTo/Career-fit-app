generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                 String       @id @default(uuid())
  email              String       @unique
  passwordHash       String
  name               String?
  securityQuestion   String
  securityAnswerHash String
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  about              String?
  currentCompany     String?
  currentRole        String?
  headline           String?
  linkedinUrl        String?
  location           String?
  phoneNumber        String?
  quickAnalysisUsed  Int          @default(0)
  interviews         Interview[]
  profile            UserProfile?

  @@index([email])
}

model Interview {
  id              String    @id @default(uuid())
  userId          String
  interviewType   String    @default("deep")
  status          String    @default("in_progress")
  currentModule   String?
  currentQuestion Int?
  startedAt       DateTime  @default(now())
  completedAt     DateTime?
  lastActivityAt  DateTime  @updatedAt
  personalityData Json?
  talentsData     Json?
  valuesData      Json?
  sessionData     Json?
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  results         Result[]

  @@index([userId])
  @@index([status])
  @@index([interviewType])
}

model Result {
  id              String    @id @default(uuid())
  interviewId     String
  aScore          Float     @default(0)
  a1Score         Float     @default(0)
  a2Score         Float     @default(0)
  a3Score         Float     @default(0)
  confidenceLevel String    @default("medium")
  careerMatches   Json
  topCareer       String
  topFitScore     Float
  generatedAt     DateTime  @default(now())
  interview       Interview @relation(fields: [interviewId], references: [id], onDelete: Cascade)

  @@index([interviewId])
}

model Career {
  id               String   @id @default(uuid())
  name             String   @unique
  vietnameseName   String
  description      String
  requirements     Json
  avgSalaryVND     String?
  workHoursPerWeek Int?
  stressLevel      String?
  growthPotential  String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  cachedAnalysis   Json?
  category         String   @default("general")

  @@index([name])
  @@index([category])
}

model UserProfile {
  id               String          @id @default(uuid())
  userId           String          @unique
  firstName        String
  lastName         String
  profilePhoto     String?
  headline         String?
  location         String?
  bio              String?
  linkedIn         String?
  github           String?
  portfolioUrl     String?
  twitter          String?
  visibility       String          @default("public")
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  educationRecords Education[]
  experiences      Experience[]
  portfolioItems   PortfolioItem[]
  skills           Skill[]
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Skill {
  id        String      @id @default(uuid())
  profileId String
  name      String
  level     String
  verified  Boolean     @default(false)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  profile   UserProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([profileId, name])
  @@index([profileId])
}

model Experience {
  id          String      @id @default(uuid())
  profileId   String
  title       String
  company     String
  location    String?
  startDate   DateTime
  endDate     DateTime?
  current     Boolean     @default(false)
  description String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  profile     UserProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Education {
  id             String      @id @default(uuid())
  profileId      String
  degree         String
  institution    String
  major          String?
  graduationYear String
  description    String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  profile        UserProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model PortfolioItem {
  id          String      @id @default(uuid())
  profileId   String
  title       String
  description String
  type        String
  url         String?
  imageUrl    String?
  skills      Json        @default("[]")
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  profile     UserProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([type])
}
